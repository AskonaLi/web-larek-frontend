# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс товара
```
interface IProductItem {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number;
}
```

Интерфейс массива с товарами
```
interface IProductList {
  productItems: IProduct[];
}
```

Интерфейс формы способа оплаты
```
interface IOrderFormPayment {
  payment: string;
  deliveryAddress: string;
}
```

Интерфейс формы контактных данных
```
interface IOrderFormContacts {
  phoneNumber: number;
  email: string;
}
```

Интерфейс успешной отправки заказа
```
interface ISucessOrder {
  id: string;
  total: number;
}
```

Интерфейс корзины
```
interface IBasket {
  orders: BasketProductItem[];
  totalValue: number;
}
```

Тип товара в корзине
```
type BasketProductItem = Pick<IProduct, 'id' | 'title' | 'price'>;
```

Тип товара во всплывающем окне выбранного товара
```
type PopupProduct = Pick<IProduct, 'category' | 'title' | 'description' | 'price'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой данных, отвечает за хранение и изменение данных;
- слой представления, отвечает за отображение данных на странице;
- слой презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. 
Основные особенности класса включают:
- Базовый URL - при создании экземпляра класса необходимо указать базовый URL для запросов.
- Опции запроса - позволяет задавать дополнительные параметры запроса через аргумент options, включая заголовки. По умолчанию заголовок Content-Type установлен в application/json.
- Методы GET и POST: Поддерживаются методы GET и POST, а также поддерживаемые варианты методов PUT и DELETE через параметр method.
Защита от ошибок: В случае ошибки запрос возвращается с сообщением об ошибке (Promise.reject), иначе возвращается JSON.
Содержит методы:
- get - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- post - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Класс EventEmitter является реализацией брокера событий, который позволяет управлять подписками и эмиттированием событий в приложении. Основные функции этого класса включают:
Содержит методы:
- on - имя события и функцию-обработчик, которые будут вызываться при возникновении данного события.
- off - позволяет отменить подписку на определенное событие
- emit - вызывает все зарегистрированные обработчики для конкретного события
- onAll - позволяет слушать все события
- offAll - позволяет сбросить все обработчики
- trigger - позволяет сделать коллбек триггер, генерирующий событие при вызове

### Слой данных (Model)
Предназначен для хранения и обработки данных о товарах, заказах, и способах доставки этих заказов

#### Класс Model
Представляет собой базовую структуру для создания моделей данных, которые могут уведомлять о изменениях через события. 
Особенности класса включают:
- Конструктор - конструктор принимает данные и экземпляр интерфейса IEvents. Данные копируются в новый объект модели.
- Сообщение об изменениях - метод emitChanges используется для уведомления о изменениях модели, отправляя событие с возможным значением данных.
- Гарда - функция isModel проверяет, является ли объект экземпляром класса Model.

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

Содержит методы:
getProductItem - получает данные о товаре с сервера
IProductList - получает массив товаров с сервера
sendOrderData - отправляет данные о заказанных товарах, контактных данных, и способе оплаты

#### Класс Catalog
Хранит в себе данные о каталоге товаров ввиде массива.

Содержит методы:
- setCatalog - устанавливает данные о каталоге товаров, отправляет событие об изменении данных в каталоге
- getCatalog - получает обновленные данные о каталоге товаров

#### Класс ProductItem
Хранит в себе данные о товаре. Конструктор класса принимает два параметра: объект data типа IProductItem и объект событий events.

#### Класс Basket
Хранит в себе данные о товарах, которые пользователь добавил в корзину

Содержит методы:
- addBasketOrder - добавляет товар в корзину
- deleteBasketOrder - удаляет товар их корзины
- clearBasket - очищает корзину
- getTotalPrice - рассчитывает общую стоимость товаров в корзине.
getBasketOrdersId - возвращает массив идентификаторов товаров для передачи на сервер.
- getBasketOrders - получает список товаров и генерирует событие, сигнализирующее об изменении в корзине.
- placeAnOrder - оформляет заказ нажатием на кнопку "Оформить". Генерирует событие оформления заказа
- changeBasketOrders - генерирует событие изменения. Вызывается при изменении данных в корзине

#### Класс PlacedOrder
Хранит в себе данные об оформленном заказе. Данные отправляются сюда из корзины
- getOrder - получает данные об оформленном заказе с сервера
- sendOrder - отправляет данные об оформленном заказе на сервер

#### Класс ContactsOrder
Хранит в себе данные о способе оплаты, адресе доставки, E-mail, телефоне

Содержит методы:
- setPayNDeliever - устанавливает значения для полей способов оплаты и адреса доставки. Проводит валидацию данных через специальный метод validationDelivery. Если валидация успешна, создает событие и передает экземпляр класса.
- setContacts - задает значения для полей email и телефона. Валидирует данные через validationContacts. При успешной валидации создает событие и передает экземпляр класса.


### Слой представления (View)
Отвечает за визуальное отображение данных на странице. Обрабатывает пользовательские взаимодействия, такие как клики, нажатия и другие события. Реагирует на изменения состояния приложения и обновляет визуальные компоненты в соответствии с новыми данными. Компонует визуальные элементы в пользовательском интерфейсе. Обеспечивает адаптивность и доступность интерфейса для различных устройств и пользователей.

#### Класс Modal
Отвечает за отображение различного контента в модальном окне.

Содержит поля:
- closeButton - кнопка закрытия модального окна
- content - контент, который выводится в модальном окне

Конструктор принимает HTMLElement с контентом модального окна и events - объект с событием, вешает слушатели на кнопки

Содержит методы:
- set content() - размещает контент в модальном окне
- open - открывает модальное окно
- close - закрывает модальное окно
- render - отрисовывает контент и открывает модальное окно

#### Класс Component
Класс Component представляет собой базовую структуру для создания компонентов пользовательского интерфейса. Конструктор принимает контейнер HTML-элемента, внутри которого будет размещаться компонент.

Содержит методы:
- toggleClass(element: HTMLElement, className: string, force?: boolean) - Переключить класс
- setText(element: HTMLElement, value: unknown) - Установить текстовое содержимое
- setDisabled(element: HTMLElement, state: boolean) - Поменять статус блокировки
- protected setHidden(element: HTMLElement) - Скрыть элемент
- protected setVisible(element: HTMLElement) - Показать элемент
- setImage(element: HTMLImageElement, src: string, alt?: string) - Установить изображение с алтернативным текстом
- render(data?: Partial<T>): HTMLElement - Вернуть корневой DOM-элемент



#### Класс MainPageView
Представляет метод отображения на главной странице. Он содержит элементы для отображения каталога товаров, кнопки корзины и счетчика количества товаров в корзине. Конструктор класса принимает контейнер и события, и устанавливает обработчики событий для кнопки корзины.

Содержит поля:
- basketCounter - html-элемент счётчика общей стоимости товаров в корзине
- basketClick - html-элемент кнопки для открытия корзины
- productListElement - html-элемент каталога товаров

Содержит методы:
- set catalog - позволяет установить каталог товаров
- set basketCountBumber - позволяет установить количество товаров в корзине и состояние блокировки контейнера

#### Класс CardView
Отвечает за отображение и взаимодействие с элементами карточки. Конструктор класса принимает контейнер и действия, и устанавливает обработчики событий для кнопки, если они предоставлены. 
Содержит поля:
- categoryCardElement
- titleCardElement
- imageCardElement
- priceCardElement

Содержит методы:
- set category - устанавливает картегорию
- set title - размещает контент для загололовка
- set description - размещает контент для описания
- set image - размещает картинку
- set price - устанавливает стоимость товара

#### Класс CardPreview
Расширяет класс CardView и представляет предпросмотр карточки товара. Он содержит элементы для отображения описания товара и кнопки добавления/удаления из корзины. Конструктор класса принимает контейнер и действия, и устанавливает обработчики событий для кнопки.

Содержит поля:
- cardPreviewDescription – элемент для описания товара.
- buttonCardPreviewElement – элемент кнопки добавления/удаления товара из корзины.
- _isAddedToBasket – приватное поле для хранения текущего состояния добавления товара в корзину.

Содержит методы:
- set description – устанавливает описание товара.
- setButtonStatus – меняет текст кнопки в зависимости от статуса добавления товара в корзину.
- get isAddedToBasket – возвращает текущее состояние добавления товара в корзину.
- set isAddedToBasket – меняет состояние добавления товара в корзину и соответствующим образом меняет текст кнопки.
- render – основной метод рендеринга карточки товара.

#### Класс BasketView
Отвечает за отображение взаимодействие с элементами корзины. Он содержит элементы для отображения списка товаров в корзине, кнопки оформления заказа и общей суммы товаров. Конструктор класса принимает контейнер и события, и устанавливает обработчики событий для кнопки оформления заказа. Методы класса позволяют установить список товаров, общую сумму товаров и статус кнопки оформления заказа.

Содержит поля:
- basketList - элемент списка товаров в корзине
- basketOrderButton - кнопка оформления заказа
- totalAmountBasket - элемент для отображения итоговой суммы в корзине

Содержит методы:
- set productItems - устанавливает список продуктов в корзине, обновляет список товаров и отображает их количество
- set totalPriceNumber - устанавливает итоговую сумму в корзине и отображает ее количество синапсов

#### Класс PayOrderFormView
Представляет форму для заполнения данных доставки и оплаты. Конструктор класса принимает контейнер формы и события, и устанавливает обработчики событий для кнопки отправки формы и кнопок выбора способа оплаты.
Содержит методы:
- set payOption - отвечает за выбор способа оплаты
- set deliveryAdress - отвечает за выбор адреса доставки
- resetButtons - сбрасывает состояние активной кнопки
- onInputChange - обрабатывает изменения в полях формы. Когда пользователь вводит данные в любое поле формы, этот метод вызывает событие deliveryOrder:change, передавая имя поля и новое значение. Это позволяет другим частям приложения реагировать на изменения в форме.

#### Класс ContactsView
Представляет форму для ввода контактных данных при оформлении заказа. Конструктор класса принимает контейнер формы и события, и устанавливает обработчик события для кнопки отправки формы.

Содержит методы:
- set email - отвечает за выбор электронной почты
- set phoneNumber - отвечает за выбор номера телефона
onInputChange - обрабатывает изменения в полях формы. Когда пользователь вводит данные в любое поле формы, этот метод вызывает событие contactsOrder:change, передавая имя поля и новое значение. Это позволяет другим частям приложения реагировать на изменения в форме.

#### Класс PlacedOrder
Представляет окно подтверждения успешного заказа. Конструктор класса принимает контейнер окна и действия, и устанавливает обработчики событий для кнопки закрытия окна. Методы класса позволяют установить общую сумму заказа и уникальный идентификатор заказа.

Содержит поля:
- _totalPrice - разметка итоговой стоимости товара
- _newBuying - разметка кнопки "За новыми покупками"

Содержит методы:
- set orderTotalPrice - устанавливает итоговую стоимость товара
- set id - устанавливает уникальный идентификатор заказа

#### Класс Form
Представляет собой компонент формы, который управляет состоянием валидации и отображением ошибок.
Конструктор принимает форму и экземпляр интерфейса IEvents. Настраивает обработчики событий для кнопки отправки и элемента с ошибками. Обрабатывает изменение значений полей формы и эмитирует соответствующие события.
Методы set valid и set errors управляют состоянием валидности формы и отображением ошибок.
Метод render обновляет состояние валидности и ошибки, основываясь на состоянии компонента.

### Слой презентер (Presenter)
Отвечает за связь между слоем данных (Model) и слоем представления (View). 

Взаимодействие между классами в приложении можно описать следующим образом: когда пользователь выполняет какое-либо действие, происходит встроенное браузерное событие. В обработчике этого события вызывается обработчик, который вызывает метод класса модели данных для алгоритмической обработки встроенного события. Затем подготовленные данные передаются классу представления для их отображения.

Это можно представить в виде цепочки:
Визуальное представление (View) инициирует событие.
Презентер (Presenter) обрабатывает событие и передает его в модель данных (Model).
Модель данных выполняет необходимые операции и возвращает результаты презентеру.
Презентер передает эти результаты обратно в визуальное представление для отображения.

